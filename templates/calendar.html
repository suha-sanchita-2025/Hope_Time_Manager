<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Calendar - TaskFusion</title>
    <script>
        if (localStorage.getItem('theme') === 'dark') {
            document.documentElement.classList.add('dark');
        }
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = { darkMode: 'class' };
    </script>
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
    <style>
        html, body { height: 100%; margin: 0; padding: 0; }
        #calendar { flex: 1; }
    </style>
</head>
<body class="flex flex-col bg-purple-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-300 min-h-screen">

<!-- Header -->
<div class="flex justify-between items-center p-4 shadow-md bg-white dark:bg-gray-800">
    <a href="{{ url_for('index') }}"
       class="bg-white text-purple-700 border border-purple-700 px-4 py-2 rounded shadow hover:bg-purple-100 font-semibold dark:bg-gray-800 dark:text-gray-100 dark:border-gray-300">
        Home
    </a>
    <button id="darkToggle"
            class="bg-white text-purple-700 border border-purple-700 px-4 py-2 rounded shadow hover:bg-purple-100 dark:bg-gray-800 dark:text-gray-100 dark:border-gray-300">
        Toggle Dark Mode
    </button>
</div>

<!-- Centered Calendar Container -->
<div class="max-w-3xl w-full mx-auto mt-10 bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
    <h1 class="text-2xl font-bold mb-4 text-center">Task Calendar</h1>
    <div id="calendar" class="p-2 bg-white dark:bg-gray-800 rounded-lg"></div>
</div>

<script>
    document.getElementById('darkToggle').addEventListener('click', () => {
        document.documentElement.classList.toggle('dark');
        const isDark = document.documentElement.classList.contains('dark');
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
    });
</script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
      const calendarEl = document.getElementById('calendar');
      fetch('/api/user_tasks')
          .then(response => response.json())
          .then(tasks => {
              const today = new Date().toISOString().split('T')[0];
              const events = tasks.map(task => {
                  let color;
                  if (!task.completed && task.due_date < today) {
                      color = 'red';
                  } else if (task.category === 'work') {
                      color = 'green';
                  } else if (task.category === 'school') {
                      color = 'blue';
                  } else if (task.category === 'personal') {
                      color = 'purple';
                  }
                  return {
                      title: task.name,
                      start: task.due_date,
                      color: color
                  };
              });
              const calendar = new FullCalendar.Calendar(calendarEl, {
                  initialView: 'dayGridMonth',
                  height: 500,
                  events: events
              });
              calendar.render();
          });
  });
</script>
</body>
</html>